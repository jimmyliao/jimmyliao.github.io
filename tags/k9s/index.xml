<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>K9S on JimmyLiao Notes</title><link>https://jimmyliao.net/tags/k9s/</link><description>Recent content in K9S on JimmyLiao Notes</description><generator>Hugo -- gohugo.io</generator><copyright>Copyright © 2008–2018, Steve Francia and the Hugo Authors; all rights reserved.</copyright><lastBuildDate>Fri, 24 Sep 2021 23:35:28 +0800</lastBuildDate><atom:link href="https://jimmyliao.net/tags/k9s/index.xml" rel="self" type="application/rss+xml"/><item><title>HOWTO: connect to remote 1-click PrimeHub</title><link>https://jimmyliao.net/post/2021-09-24-primehub-oneclick/</link><pubDate>Fri, 24 Sep 2021 23:35:28 +0800</pubDate><guid>https://jimmyliao.net/post/2021-09-24-primehub-oneclick/</guid><description>
&lt;p>&lt;strong>How to connect to remote &lt;a href="https://one.primehub.io">1-click PrimeHub&lt;/a> instance&lt;/strong>&lt;/p>
&lt;p>PrimeHub &lt;a href="https://medium.com/infuseai/whats-new-in-primehub-3-8-40f107035fbc">3.8&lt;/a> 開始提供了 1-click to AWS 的快速部署 PrimeHub 方式，點下 &lt;code>1-Click Install on AWS&lt;/code> 之後，填入你的 email 並點下 Deploy 之後，就可以先去喝杯咖啡等待郵件通知 PrimeHub on AWS 部署完成。&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-24-01.png" alt="">&lt;/p>
&lt;p>不過從系統管理角度，如何透過 kubectl 連到遠端的 1-click PrimeHub 呢？&lt;/p>
&lt;p>很簡單，在收到的 email 裡面有個連結，會先 redirect 到 AWS CloudFormation 畫面。&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-24-02.png" alt="">&lt;/p>
&lt;p>裡面有幾個提示，主要把紅色這段複製貼上到 Terminal 即可。(該裝的 AWS cli 跟 credential 什麼的還是要設定一下)&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-24-03.png" alt="">&lt;/p>
&lt;p>又可以快快樂樂使用 K9S 啦！&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-24-04.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-24-05.png" alt="">&lt;/p></description></item><item><title>如何連到遠端的 MicroK8s 並用 K9S monitoring</title><link>https://jimmyliao.net/post/2021-09-01-k9s-microk8s/</link><pubDate>Thu, 02 Sep 2021 22:47:55 +0800</pubDate><guid>https://jimmyliao.net/post/2021-09-01-k9s-microk8s/</guid><description>
&lt;p>&lt;strong>如何連到遠端的 MicroK8s 並用 K9S 快快樂樂的管理 Kubernetes&lt;/strong>&lt;/p>
&lt;p>使用 kubectl command 管理 Kubernetes Cluter 為工程師基本技能，用久了自然而然就想找些更適合習慣 Terminal 操作但又想有點 hacky 的介面，從強者同事分享的工具集才發現根本是超讚的東西阿！&lt;/p>
&lt;p>前置作業：
大致上就是在 AWS 上面開個 EC2 instance，裝個 Ubuntu 20.04 Server Edition，其他就照 K9S 跟 MicroK8s 官網安裝。(秘技: 其實裝個 &lt;a href="(https://docs.primehub.io/docs/getting_started/kubernetes_on_ubuntu_ce)">PrimeHub CE&lt;/a> 照著步驟到 &lt;a href="https://docs.primehub.io/docs/getting_started/kubernetes_on_ubuntu_ce#quick-verification">Quick Verification
&lt;/a> 也是更快的選項)&lt;/p>
&lt;p>你應該可以 ssh 到這台 EC2，輸入 &lt;code>k9s&lt;/code>&lt;/p>
&lt;p>驗證在該台主機上可以透過 K9S 看到 Cluster 資訊沒問題！&lt;/p>
&lt;p>接著來到這篇的主題：透過 laptop 連到遠端的主機&lt;/p>
&lt;p>首先，你會發現即使你知道主機的 public IP，嘗試透過 &lt;code>~/.kube/config&lt;/code> 並放到 laptop 的 kube config&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">~$ cat ~/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">clusters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl">- cluster:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl"> certificate-authority-data: &amp;lt;YOUR_CERT_DATA&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl"> server: https://127.0.0.1:16443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl"> name: microk8s-cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl">contexts:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl">- context:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl"> cluster: microk8s-cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">11&lt;/span>&lt;span class="cl"> user: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">12&lt;/span>&lt;span class="cl"> name: microk8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">13&lt;/span>&lt;span class="cl">current-context: microk8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">14&lt;/span>&lt;span class="cl">kind: Config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">15&lt;/span>&lt;span class="cl">preferences: &lt;span class="o">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">16&lt;/span>&lt;span class="cl">users:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">17&lt;/span>&lt;span class="cl">- name: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">18&lt;/span>&lt;span class="cl"> user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">19&lt;/span>&lt;span class="cl"> token: &amp;lt;YOUR_-_TOKEN&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改對應的 &lt;code>server: https://&amp;lt;EC2_PUBLIC_IP&amp;gt;:16443&lt;/code> ，也打開 EC2 上的 &lt;code>16443&lt;/code> port&lt;/p>
&lt;p>發現怎麼在打 &lt;code>kubectl get node&lt;/code> 時找不到&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln">1&lt;/span>&lt;span class="cl">Unable to connect to the server: x509: certificate is valid &lt;span class="k">for&lt;/span> 127.0.0.1, 10.152.183.1, 192.168.1.123, not &amp;lt;EC2_PUBLIC_IP&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>記得先檢查 MicroK8s 的 metrics-server 有沒有 enabled。有 enabled 的話才不會在 K9S 上面看到 CPU/MEM 是 n/a&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">~$ microk8s status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">microk8s is running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">high-availability: no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl"> datastore master nodes: 127.0.0.1:19001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl"> datastore standby nodes: none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">addons:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl"> enabled:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl"> dns &lt;span class="c1"># CoreDNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl"> ha-cluster &lt;span class="c1"># Configure high availability on the current node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl"> metrics-server &lt;span class="c1"># K8s Metrics Server for API access to service metrics&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">11&lt;/span>&lt;span class="cl"> rbac &lt;span class="c1"># Role-Based Access Control for authorisation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">12&lt;/span>&lt;span class="cl"> storage &lt;span class="c1"># Storage class; allocates storage from host directory&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然後找了一些文件，有一說是在kube-apiserver設定檔案，新增 &lt;code>--bind-address&lt;/code>，像是&lt;a href="https://microk8s.io/docs/external-lma">這個&lt;/a> 跟 &lt;a href="https://discuss.kubernetes.io/t/microk8s-with-an-external-lma/13595">這個&lt;/a>。重啟 MicroK8s 之後沒什麼幫助。直到我找到 &lt;a href="https://discuss.kubernetes.io/t/is-there-a-way-to-access-microk8s-using-kubectl-outside-the-local-network/15488">這篇&lt;/a>，內容大意是說，像是 EC2 這種 instance 的 Public IP 並沒有實際在 network interface 指定，而是透過 EC2 方式給定一組 Public IP 指定給這個 instance，就需要在 &lt;code>/var/snap/microk8s/current/certs/csr.conf.template&lt;/code> 裡面新增一個 IP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">&lt;span class="o">[&lt;/span> alt_names &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">DNS.1 &lt;span class="o">=&lt;/span> kubernetes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">DNS.2 &lt;span class="o">=&lt;/span> kubernetes.default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl">DNS.3 &lt;span class="o">=&lt;/span> kubernetes.default.svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl">DNS.4 &lt;span class="o">=&lt;/span> kubernetes.default.svc.cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">DNS.5 &lt;span class="o">=&lt;/span> kubernetes.default.svc.cluster.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl">IP.1 &lt;span class="o">=&lt;/span> 127.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl">IP.2 &lt;span class="o">=&lt;/span> 10.152.183.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl">IP.99 &lt;span class="o">=&lt;/span> &amp;lt;EC2_PUBLIC_IP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl">&lt;span class="c1">#MOREIPS&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>記得這裡千萬別自認為要直接指定 &lt;code>IP.3&lt;/code> ，而是要指定從 &lt;code>IP.100&lt;/code> 或是往下遞減，這邊先給個 &lt;code>IP.99&lt;/code>。&lt;/p>
&lt;p>改好並 restart microk8s 之後就可以遠端執行 &lt;code>kubectl&lt;/code> 啦！&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln">1&lt;/span>&lt;span class="cl">~$ kubectl get node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">2&lt;/span>&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">3&lt;/span>&lt;span class="cl">ip-10-40-0-11 Ready &amp;lt;none&amp;gt; 4d1h v1.19.13-34+939585d5fb6fa7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然後就可以快快樂樂的在 laptop 直接監控 Cluster 囉～&lt;/p>
&lt;p>&lt;img src="https://jimmyliao.net/images/2021-09-01-k9s.png" alt="">&lt;/p></description></item></channel></rss>